---
layout: api
page_title: Consistency Modes
description: >-
  Every Consul HTTP API read request uses one of several "consistency modes" that offer
  different levels of response consistency and performance. By default, Consul uses a
  consistency mode that is ideal for most use cases. Users can override consistency modes
  to fine-tune these trade-offs for their own use case.
---

# Consistency Modes

Every Consul HTTP API read request uses one of several "consistency modes" that offer
different levels of response consistency and performance. By default, Consul uses a
consistency mode that is ideal for most use cases. Users can override consistency modes
to fine-tune these trade-offs for their own use case at two levels:
- Per interface (HTTP API, DNS)
- Per request (HTTP API requests only)

## What is Consistency?

Consul servers are responsible for maintaining state information like the registration and
health status of services and nodes. To protect this state against the potential failure of
Consul servers, this state is replicated across 3+ Consul servers in production using a
[consensus protocol](/docs/architecture/consensus).

One Consul server is elected leader and acts as the ultimate authority on Consul's state.
If a majority of Consul servers agree to a state change, the leader is responsible for recording
the change and then distributing it to the non-leader Consul servers—known as followers.
Because it takes time for a state change on the leader to propagate to the followers,
followers may have a slightly outdated, or "stale", view of Consul's state.

If a read request is handled by the current leader, the response is guaranteed
to be the most up-to-date—fully "consistent". If the same request were handled by a
follower, the response may be based on an arbitrarily stale copy of the leader's
state—less consistent. Consistency is highest if the response comes from the leader.
But ensuring only the leader can respond to the request requires more work,
decreasing performance.

The consistency mode controls which Consul servers can repond to read requests,
enabling control over this inherent trade-off between consistency and performance.

## Available Consistency Modes

Each HTTP API endpoint documents its support for the three read consistency modes:

- `default` - If not specified, the default is strongly consistent in almost all
  cases. However, there is a small window in which a new leader may be elected
  during which the old leader may service stale values. The trade-off is fast
  reads but potentially stale values. The condition resulting in stale reads is
  hard to trigger, and most clients should not need to worry about this case.
  Also, note that this race condition only applies to reads, not writes.

- `consistent` - This mode is strongly consistent without caveats. It requires
  that a leader verify with a quorum of peers that it is still leader. This
  introduces an additional round-trip to all server nodes. The trade-off is
  increased latency due to an extra round trip. Most clients should not use this
  unless they cannot tolerate a stale read.

- `stale` - This mode allows any server to service the read regardless of
  whether it is the leader. This means reads can be arbitrarily stale; however,
  results are generally consistent to within 50 milliseconds of the leader. The
  trade-off is very fast and scalable reads with a higher likelihood of stale
  values. Since this mode allows reads without a leader, a cluster that is
  unavailable will still be able to respond to queries.

  ~> **Scaling read requests**: horizontally scaling Consul servers under
  heavy request load will only help if most requests are `stale` reads.
  This is because `stale` reads are the only requests that can be handled by
  server agents other than the leader. Other requests will always be handled
  by the leader no matter the number of Consul servers.
  The most effective way to increase read scalability is to convert non-`stale`
  reads to `stale` reads.
  Only `stale` requests benefit from the enhanced read scalability provided by
  [read replicas](/docs/enterprise/read-scale) and
  [redundancy zones](/docs/enterprise/redundancy).

### Intra-Datacenter Request Behavior

The following diagrams show how the intra-datacenter request path varies
per consistency mode and the relative trade-offs between level of consistency and performance.

<Tabs>
<Tab heading="Stale reads">

[![stale consistency mode read request path](/img/consistency-modes/consistency-mode-stale.png)](/img/consistency-modes/consistency-mode-stale.png)

</Tab>

<Tab heading="Default reads">

[![default consistency mode read request path](/img/consistency-modes/consistency-mode-default.png)](/img/consistency-modes/consistency-mode-default.png)

</Tab>
<Tab heading="Consistent reads, all writes">

[![consistent consistency mode read, any write request path](/img/consistency-modes/consistency-mode-consistent.png)](/img/consistency-modes/consistency-mode-consistent.png)

</Tab>
</Tabs>

### Cross-Datacenter Request Behavior

When making a request across federated Consul datacenters, requests are forwarded from
a local server to any remote server. Once in the remote datecenter, the request path
is the same as a [local request with the same consistency mode](#intra-datacenter-request-behavior).

[![consistency mode behavior across Consul datacenters](/img/consistency-modes/consistency-mode-cross-datacenter.png)](/img/consistency-modes/consistency-mode-cross-datacenter.png)

## Usage

### Consul DNS Queries: Defaults and Overriding

When DNS queries are issued to [Consul's DNS interface](/docs/discovery/dns),
Consul uses the `stale` consistency mode by default when interfacing with its
underlying Consul service discovery HTTP APIs
([catalog](/api-docs/catalog), [health](/api-docs/health), and [query](/api-docs/query)).
Though this default can be changed, doing so is not recommended.

The consistency mode underlying Consul DNS queries cannot be overridden on a
per-request basis.

#### Changing the Default Consistency Mode

If stronger consistency is required at the expense of increased latency,
set [`dns_config.allow_stale`] to `false` to make Consul use the
`default` consistency mode instead of `stale`
when interfacing with the underlying Consul service discovery HTTP APIs.

#### Limiting Staleness (Advanced Usage)

~> **Not recommended**: we do not recommend using [`dns_config.max_stale`]
to limit staleness in most use cases because it will exacerbate situations in which responses
are stale due to server overload.

If [`dns_config.allow_stale`] is `true` (default), `stale` consistency mode is in use for DNS queries.
To set an upper limit on how stale a response is allowed to be, specify [`dns_config.max_stale`]
in the configuration of the Consul agent serving DNS queries.
If the Consul agent handling the response is behind the leader by more than [`dns_config.max_stale`]
time, the request will be forwarded to the leader for handling like in `default` consistency mode.

The most likely cause for response staleness to exceed [`dns_config.max_stale`] is that
Consul servers are overloaded by their request load. Under these circumstances, [`dns_config.max_stale`]
will exacerbate the problem by converting cheap `stale` reads into more expensive `default` reads.

### Consul HTTP API Queries: Defaults and Overriding

All HTTP API read requests use the `default` consistency mode by default
unless overridden on a per-request basis. Though this default can be changed,
doing so is not recommended.

Write requests do not support defining a consistency mode.
All writes follow the behavior of the `consistent` consistency mode.

#### Overridding a Request's Consistency Mode

The HTTP API documentation for each endpoint lists which consistency modes can be used
to override the default on a per-request basis. To use a supported consistency mode
other than the default, including the desired consistency mode as a query parameter in the query:
- `stale`: use the `stale` query parameter
- `consistent`: use the `consistent` query parameter
- `default`: use the `leader` query parameter;
   only relevant [if the default consistency mode is changed to `stale`](#changing-the-default-consistency-mode-advanced-usage)

#### Changing the Default Consistency Mode (Advanced Usage)

~> **Not recommended**: we do not recommend using
[`discovery_max_stale`](/docs/agent/options#discovery_max_stale)
to limit staleness in most use cases because it will exacerbate situations in which responses
are stale due to server overload.

Only the service discovery HTTP API endpoints
([catalog](/api-docs/catalog), [health](/api-docs/health), and [query](/api-docs/query))
allow changing the consistency mode used by default. By setting
[`discovery_max_stale`](/docs/agent/options#discovery_max_stale)
to a value greater than zero in the configuration of the Consul agent receiving requests,
the `stale` consistency mode will be used by default unless the data is sufficiently stale.
Setting a positive value for [`discovery_max_stale`](/docs/agent/options#discovery_max_stale)
is analogous to [limiting the staleness of Consul DNS queries](#limiting-staleness-advanced-usage)
by setting [`dns_config.max_stale`].

The most likely cause for response staleness to exceed [`dns_config.max_stale`] is that
Consul servers are overloaded by their request load. Under these circumstances, [`dns_config.max_stale`]
will exacerbate the problem by converting cheap `stale` reads into more expensive `default` reads.

### Visibility into Response Staleness

To support bounding the acceptable staleness of data, responses provide the
`X-Consul-LastContact` header containing the time in milliseconds that a server
was last contacted by the leader node. The `X-Consul-KnownLeader` header also
indicates if there is a known leader. These can be used by clients to gauge the
staleness of a result and take appropriate action.

### Relationship to Request Caching

Note that some HTTP API endpoints support a `cached` parameter which has some of the same
semantics as `stale` consistency mode but different trade offs. This behavior is described in
[agent caching feature documentation](/api/features/caching).

<!-- Common links references -->
[`dns_config.allow_stale`]: /docs/agent/options#allow_stale)
[`dns_config.max_stale`]: /docs/agent/options#max_stale
[`discovery_max_stale`]: /docs/agent/options#discovery_max_stale